matrix:
    include:
      - os: linux
        language: cpp
        compiler: gcc
        dist: focal
        sudo: true
        addons:
          apt:
            update: true
              - g++-9
              - gcc-9
      - os: osx
        osx_image: xcode12.5
        language: generic
        sudo: true
        addons:
          homebrew:
            packages:
            - boost-python3
            - boost-build

install:
  - python3 --version
  - make libtorrent
  - cat ~/user-config.jam
  - cat libtorrent/bindings/python/user-config.jam
  #- export BOOST_BUILD_PATH=${PWD}/boost_1_74_0/tools/build
  #- export BOOST_ROOT=${PWD}/boost_1_74_0
  - make build-libtorrent
script:
  - python3 test.py

before_deploy:
  - zip build-$TRAVIS_OS_NAME.zip lib/__init__.py lib/libtorrent.so __init__.py TorrentPlugin.py AlertEncoder.py test.py
deploy:
  provider: releases
  skip_cleanup: true
  api_key:
    secure: $GH_TOKEN
  file:
    - build-$TRAVIS_OS_NAME.zip
  on:
    tags: true
