language: generic
matrix:
    include:
      - os: linux
        dist: trusty
        sudo: false
        addons:
          apt:
            update: true
            sources:
              - george-edison55-precise-backports
              - ubuntu-toolchain-r-test
            packages:
              - cmake
              - cmake-data
              - python-dev
              - python-all
              - python-all-dev
              - python-gevent
              - python-greenlet
              - python-minimal
              - python-msgpack
              - python-wheel
              - g++-7
          env:
            - MATRIX_EVAL="CC=gcc-7 && CXX=g++-7"
      - os: osx

before_install:
  - eval "${MATRIX_EVAL}"
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then pip install conan; else pip install --user conan; fi
  - conan remote add libtorrent https://api.bintray.com/conan/rllola80/Libtorrent
install:
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then  conan install --build=missing .; else conan install --build=missing -s compiler.version=7 .; fi
  - conan build .
script:
  - python test.py
